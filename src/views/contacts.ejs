<%- include("./includes/head"); %> <%- include("./includes/navbar"); %>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8 my-4">
      <h1 class="text-center">Agenda</h1>
      <p class="text-center lead">
        <%= isEditing ? "Edite as informações do contato selecionado" :
        "Organize seus contatos de forma simples e segura" %>
      </p>

      <%- include("./includes/messages"); %>

      <!-- Card -->
      <div class="card shadow-sm">
        <div class="card-body">
          <!-- TÍTULO DO FORM -->
          <h5 class="mb-3 text-center">
            <%= isEditing ? "Editar contato" : "Adicionar contato" %>
          </h5>

          <!-- FORMULÁRIO -->
          <form
            action="<%= contact._id ? `/contacts/${contact._id}` : `/contacts` %>"
            method="POST"
            data-validate="contactValidator"
          >
            <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="name">Nome</label>
                <input
                  value="<%= contact.nome || '' %>"
                  type="text"
                  class="form-control"
                  id="name"
                  name="name"
                  required
                />
              </div>

              <div class="form-group col-md-6">
                <label for="lastname">Sobrenome</label>
                <input
                  value="<%= contact.sobrenome || '' %>"
                  type="text"
                  class="form-control"
                  id="lastname"
                  name="lastname"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="phone">Telefone</label>
                <input
                  value="<%= contact.telefone || '' %>"
                  type="text"
                  class="form-control"
                  id="phone"
                  name="phone"
                />
              </div>

              <div class="form-group col-md-6">
                <label for="email">E-mail</label>
                <input value="<%= contact.email || '' %>" type="email"
                class="form-control" id="email" name="email" <%= isEditing ?
                "readonly" : "" %> />
              </div>
            </div>

            <!-- BOTÕES -->
            <button
              type="submit"
              class="btn btn-block <%= isEditing ? 'btn-info' : 'btn-dark' %>"
            >
              <%= isEditing ? "Atualizar contato" : "Salvar contato" %>
            </button>

            <% if (isEditing) { %>
            <a
              href="/contacts"
              class="btn btn-outline-secondary btn-block mt-2"
            >
              Cancelar edição
            </a>
            <% } %>
          </form>

          <hr />

          <!-- TABELA -->
          <div class="table-responsive mt-3">
            <table class="table table-hover">
              <thead class="thead-dark">
                <tr>
                  <th>Nome</th>
                  <th>Sobrenome</th>
                  <th>Telefone</th>
                  <th>Email</th>
                  <th class="text-center">Editar</th>
                  <th class="text-center">Deletar</th>
                </tr>
              </thead>

              <tbody>
                <% if (contacts && contacts.length) { %> <%
                contacts.forEach(function (c) { %>
                <tr
                  class="<%= isEditing && c._id.toString() === contact._id?.toString() ? 'table-info' : '' %>"
                >
                  <td><%= c.nome %></td>
                  <td><%= c.sobrenome %></td>
                  <td><%= c.telefone %></td>
                  <td><%= c.email %></td>

                  <!-- EDITAR -->
                  <td class="text-center">
                    <a
                      href="/contacts/<%= c._id %>"
                      class="btn btn-sm btn-info"
                    >
                      Editar
                    </a>
                  </td>

                  <!-- DELETAR -->
                  <td class="text-center">
                    <form action="/contacts/<%= c._id %>/delete" method="POST">
                      <input
                        type="hidden"
                        name="_csrf"
                        value="<%= csrfToken %>"
                      />
                      <button type="submit" class="btn btn-sm btn-danger">
                        Deletar
                      </button>
                    </form>
                  </td>
                </tr>
                <% }) %> <% } else { %>
                <tr>
                  <td colspan="6" class="text-center text-muted">
                    Nenhum contato cadastrado
                  </td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include("./includes/footer"); %>
